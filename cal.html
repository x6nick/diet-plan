<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Smart Diet Dashboard — Calculators Integrated</title>
  <meta name="description" content="Smart Diet Dashboard with integrated calculators (BMI, BMR/TDEE, Ideal weight, Body fat) & tracker integration" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#071025;
      --panel:#0f1724;
      --card:#0b1220;
      --muted:#94a3b8;
      --accent:#06b6d4;
      --accent2:#7c3aed;
      --good:#10b981;
      --warn:#f59e0b;
      --danger:#ef4444;
      --glass: rgba(255,255,255,0.03);
      --radius:12px;
      --max-width:1150px;
      color-scheme: dark;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
      background: linear-gradient(180deg,var(--bg),#04101a 140%);
      color:#e6eef6;
      padding:18px;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      line-height:1.45;
    }
    .wrap{max-width:var(--max-width);margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px;flex-wrap:wrap}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent2));display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{font-size:20px;margin:0}
    p.lead{margin:0;color:var(--muted);font-size:13px}
    nav{display:flex;gap:8px;flex-wrap:wrap}
    nav a{padding:8px 10px;border-radius:10px;background:var(--glass);text-decoration:none;color:inherit;font-weight:600;font-size:13px}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));border-radius:var(--radius);padding:14px;box-shadow:0 8px 26px rgba(2,6,23,0.6)}
    h2{margin:0 0 8px 0;font-size:16px}
    .small{font-size:13px;color:var(--muted)}
    input[type=text],input[type=number],select,textarea{width:100%;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    .row{display:flex;gap:10px}
    .row > *{flex:1}
    .muted{color:var(--muted)}
    .progress{height:14px;background:rgba(255,255,255,0.04);border-radius:999px;overflow:hidden}
    .progress-bar{height:100%;width:0%;background:var(--good);transition:width .25s}
    .calc-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    .chart-small{height:60px;width:100%;display:block}
    button{padding:8px 12px;border-radius:10px;border:none;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#001;font-weight:700;cursor:pointer}
    button.ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:var(--muted)}
    .actions{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    footer{margin-top:16px;text-align:center;color:var(--muted);font-size:13px}
    @media (max-width:1100px){.grid{grid-template-columns:1fr 320px}}
    @media (max-width:880px){.grid{grid-template-columns:1fr}.calc-grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">SD</div>
        <div>
          <h1>Smart Diet — Calculators Integrated</h1>
          <p class="lead">BMI • BMR/TDEE • Ideal weight • Body fat — connected to tracker</p>
        </div>
      </div>

      <nav aria-label="Main navigation">
        <a href="#calculatorsSection">Calculators</a>
        <a href="#trackerSection">Tracker</a>
      </nav>
    </header>

    <div class="grid">
      <main>
        <section id="calculatorsSection" class="card" aria-labelledby="calcTitle">
          <h2 id="calcTitle">Fitness & Diet Calculators</h2>
          <p class="small">Enter your details and run calculators. Use the buttons to apply TDEE / macros to the tracker goals.</p>

          <div style="margin-top:10px;display:flex;gap:8px;flex-wrap:wrap">
            <input type="number" id="age" placeholder="Age (years)" style="width:110px" />
            <select id="sex" style="width:110px"><option value="male">Male</option><option value="female">Female</option></select>
            <input type="number" id="weight" placeholder="Weight (kg)" style="width:120px" />
            <input type="number" id="height" placeholder="Height (cm)" style="width:120px" />
            <select id="activity" style="width:160px">
              <option value="1.2">Sedentary</option>
              <option value="1.375">Lightly active</option>
              <option value="1.55">Moderately active</option>
              <option value="1.725">Very active</option>
              <option value="1.9">Extra active</option>
            </select>
            <button id="calcRun">Calculate</button>
          </div>

          <div class="calc-grid">
            <div class="card" id="bmiCard">
              <strong>BMI</strong>
              <div id="bmiResult" class="small muted" style="margin-top:6px">—</div>
              <canvas id="bmiChart" class="chart-small" aria-hidden="true"></canvas>
              <div class="small muted" style="margin-top:6px">BMI = kg / (m²). Healthy: 18.5–24.9</div>
            </div>

            <div class="card" id="bmrTdeeCard">
              <strong>BMR & TDEE</strong>
              <div id="bmrResult" class="small muted" style="margin-top:6px">—</div>
              <div id="tdeeResult" class="small muted">—</div>
              <div style="margin-top:8px" class="actions">
                <button id="applyTdeeBtn">Apply TDEE to Tracker</button>
                <button id="copyTdeeBtn" class="ghost">Copy TDEE</button>
              </div>
            </div>

            <div class="card" id="idealCard">
              <strong>Ideal Weight Range</strong>
              <div id="idealResult" class="small muted" style="margin-top:6px">—</div>
              <div class="small muted" style="margin-top:6px">Based on BMI 18.5–24.9</div>
            </div>

            <div class="card" id="bfCard">
              <strong>Body Fat %</strong>
              <div id="bfDeurenberg" class="small muted" style="margin-top:6px">Deurenberg: —</div>
              <div id="bfNavy" class="small muted" style="margin-top:6px">US Navy: —</div>
              <div style="margin-top:8px" class="small muted">US Navy needs neck & waist (and hip for females)</div>
              <div style="margin-top:8px;display:flex;gap:8px">
                <input type="number" id="neck" placeholder="Neck (cm)" />
                <input type="number" id="waist" placeholder="Waist (cm)" />
                <input type="number" id="hip" placeholder="Hip (cm) — females" />
              </div>
              <div class="actions" style="margin-top:8px">
                <button id="calcBfBtn" class="ghost">Calc Body Fat (Navy)</button>
              </div>
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px;align-items:center;flex-wrap:wrap">
            <label class="small muted">Recommended macro split:</label>
            <select id="macroPreset" style="width:220px">
              <option value="30-45-25">Protein 30% / Carbs 45% / Fat 25%</option>
              <option value="25-50-25">Protein 25% / Carbs 50% / Fat 25%</option>
              <option value="40-35-25">Protein 40% / Carbs 35% / Fat 25% (High protein)</option>
            </select>
            <button id="applyMacroBtn">Apply Macros to Tracker</button>
          </div>
        </section>

        <!-- Small tracker preview so user sees effect immediately -->
        <section id="trackerSection" class="card" style="margin-top:14px">
          <h2>Tracker (preview)</h2>
          <p class="small">This preview reflects current tracker goals (calories & macros). The full tracker is in your dashboard.</p>
          <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px">
            <div>
              <div class="small">Calories Goal</div>
              <div class="progress" style="margin-top:6px"><div id="calGoalBar" class="progress-bar"></div></div>
              <div class="small muted" id="calGoalText">Goal: 2000 kcal</div>
            </div>
            <div>
              <div class="small">Protein Goal</div>
              <div class="progress" style="margin-top:6px"><div id="proGoalBar" class="progress-bar" style="background:#f59e0b"></div></div>
              <div class="small muted" id="proGoalText">Goal: 120 g</div>
            </div>
            <div>
              <div class="small">Carbs Goal</div>
              <div class="progress" style="margin-top:6px"><div id="carbGoalBar" class="progress-bar" style="background:#3b82f6"></div></div>
              <div class="small muted" id="carbGoalText">Goal: 250 g</div>
            </div>
            <div>
              <div class="small">Fat Goal</div>
              <div class="progress" style="margin-top:6px"><div id="fatGoalBar" class="progress-bar" style="background:#ef4444"></div></div>
              <div class="small muted" id="fatGoalText">Goal: 70 g</div>
            </div>
          </div>
          <div class="actions" style="margin-top:10px">
            <button id="openFullTracker" class="ghost">Open Full Tracker (existing)</button>
            <button id="resetGoals" class="ghost">Reset Goals to Defaults</button>
          </div>
        </section>

        <footer>
          <div class="small muted">All calculators are estimates. For medical or clinical advice consult a professional.</div>
        </footer>
      </main>

      <aside>
        <div class="card">
          <h2>Notes & Quick Tips</h2>
          <ul class="small muted">
            <li>Use the TDEE to set maintenance calories; subtract ~300–500 kcal for weight loss.</li>
            <li>Macronutrient grams are calculated from your calorie target and chosen split.</li>
            <li>US Navy formula requires accurate circumference measurements for better estimates.</li>
          </ul>
        </div>

        <div class="card" style="margin-top:12px">
          <h2>Export / Copy</h2>
          <div class="small muted">Quick actions</div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="copyResults" class="ghost">Copy Results</button>
            <button id="printBtn" class="ghost">Print</button>
          </div>
        </div>
      </aside>
    </div>
  </div>

  <script>
    /*************** Defaults & state ***************/
    const defaults = { calories:2000, protein:120, carbs:250, fat:70 };
    let state = { goals:Object.assign({}, defaults), lastCalc:null };

    /*************** Helpers ***************/
    const $ = id => document.getElementById(id);
    function setText(id, txt){ if($(id)) $(id).textContent = txt; }
    function toast(msg){
      const t = document.createElement('div'); t.textContent = msg;
      Object.assign(t.style,{position:'fixed',right:'16px',bottom:'16px',background:'#071022',padding:'10px 12px',borderRadius:'10px',boxShadow:'0 8px 20px rgba(0,0,0,0.6)',zIndex:9999});
      document.body.appendChild(t);
      setTimeout(()=> t.remove(),1400);
    }

    /*************** BMI chart (simple linear bar) ***************/
    function drawBmiChart(bmi){
      const canvas = $('bmiChart');
      if(!canvas) return;
      const ctx = canvas.getContext('2d');
      canvas.width = canvas.clientWidth;
      canvas.height = canvas.clientHeight;
      // ranges: underweight <18.5, normal 18.5-24.9, overweight 25-29.9, obese >=30
      const ranges = [
        {name:'Under', end:18.5, color:'#0ea5a0'},
        {name:'Normal', end:24.9, color:'#10b981'},
        {name:'Over', end:29.9, color:'#f59e0b'},
        {name:'Obese', end:40, color:'#ef4444'}
      ];
      // draw segmented bar
      let x=0, w=canvas.width, total=40; // represent 0..40
      ranges.forEach(r=>{
        const segWidth = ( (r.end) / total ) * w;
        ctx.fillStyle = r.color;
        ctx.fillRect(x,0,segWidth,canvas.height/2);
        x += segWidth;
      });
      // draw marker for BMI
      const markerX = Math.min(w, (bmi/total)*w);
      ctx.fillStyle='#ffffff';
      ctx.fillRect(markerX-1,0,2,canvas.height);
      ctx.font = '11px Inter, system-ui';
      ctx.fillStyle = '#e6eef6';
      ctx.fillText('BMI: '+bmi, 6, canvas.height-6);
    }

    /*************** Calculators ***************/
    function calculateAll(){
      const age = parseFloat($('age').value) || 30;
      const sex = $('sex').value || 'male';
      const weight = parseFloat($('weight').value) || 70;
      const height = parseFloat($('height').value) || 170;
      const activity = parseFloat($('activity').value) || 1.55;

      // BMI
      const heightM = height/100;
      const bmi = +(weight / (heightM*heightM)).toFixed(1);
      setText('bmiResult', `${bmi} kg/m² — ${bmiCategory(bmi)}`);
      drawBmiChart(bmi);

      // BMR (Mifflin-St Jeor)
      const bmr = sex === 'male'
        ? Math.round(10*weight + 6.25*height - 5*age + 5)
        : Math.round(10*weight + 6.25*height - 5*age - 161);
      setText('bmrResult', `${bmr} kcal · BMR`);

      // TDEE
      const tdee = Math.round(bmr * activity);
      setText('tdeeResult', `${tdee} kcal · TDEE (activity ×${activity})`);

      // Ideal weight range (BMI 18.5 - 24.9)
      const lowW = Math.round(18.5 * heightM * heightM);
      const highW = Math.round(24.9 * heightM * heightM);
      setText('idealResult', `${lowW} kg — ${highW} kg`);

      // Deurenberg bodyfat estimate
      // %bodyfat = 1.2*BMI + 0.23*age - 10.8*sex - 5.4  (sex: male=1, female=0)
      const sexNum = sex === 'male' ? 1 : 0;
      const bfDeurenberg = +(1.2*bmi + 0.23*age - 10.8*sexNum - 5.4).toFixed(1);
      setText('bfDeurenberg', `Deurenberg: ${bfDeurenberg} % (estimate)`);

      // US Navy body fat (we'll compute when user clicks the Navy button because it needs neck/waist/hip)
      setText('bfNavy', 'US Navy: use neck & waist (and hip for female)');

      // store last calc
      state.lastCalc = { age, sex, weight, height, activity, bmi, bmr, tdee, bfDeurenberg };
      // update preview tracker goals visually (but don't override saved goal unless user applies)
      updateTrackerPreview(state.lastCalc);
      toast('Calculated — use buttons to apply to tracker');
    }

    function bmiCategory(bmi){
      if (bmi < 18.5) return 'Underweight';
      if (bmi < 25) return 'Normal';
      if (bmi < 30) return 'Overweight';
      return 'Obese';
    }

    /*************** US Navy Body Fat ***************/
    function calcNavyBF(){
      const sex = $('sex').value || 'male';
      const height = parseFloat($('height').value) || 170;
      const neck = parseFloat($('neck').value) || 0;
      const waist = parseFloat($('waist').value) || 0;
      const hip = parseFloat($('hip').value) || 0;
      if (!neck || !waist) { toast('Enter neck and waist measurements'); return; }

      // Formulas use natural logs and measurements in cm; original formulas use inches — we'll convert to cm to preserve units
      // The standard formulas are usually in inches; using cm requires a different constant. To keep simple & reliable, convert cm -> inches for formulas.
      const cmToIn = v => v / 2.54;
      const heightIn = cmToIn(height), neckIn = cmToIn(neck), waistIn = cmToIn(waist), hipIn = cmToIn(hip);

      let bf;
      if (sex === 'male') {
        // Male: % body fat = 86.010 * log10(waist - neck) - 70.041 * log10(height) + 36.76
        bf = 86.010 * Math.log10(waistIn - neckIn) - 70.041 * Math.log10(heightIn) + 36.76;
      } else {
        // Female: % body fat = 163.205 * log10(waist + hip - neck) - 97.684 * log10(height) - 78.387
        if (!hipIn) { toast('For females, hip measurement is required'); return; }
        bf = 163.205 * Math.log10(waistIn + hipIn - neckIn) - 97.684 * Math.log10(heightIn) - 78.387;
      }
      bf = +bf.toFixed(1);
      setText('bfNavy', `US Navy: ${bf} % (estimate)`);
      // store
      if (!state.lastCalc) state.lastCalc = {};
      state.lastCalc.bfNavy = bf;
      toast('US Navy body fat calculated');
    }

    /*************** Tracker integration ***************/
    // When user applies TDEE: set tracker goals (calories + macros by selected split)
    function applyTdeeToTracker(){
      if (!state.lastCalc) { toast('Run calculators first'); return; }
      const tdee = state.lastCalc.tdee;
      if (!tdee) { toast('TDEE is not available'); return; }
      // set state.goals (we'll store in localStorage so other dashboard sections can read it)
      const split = $('macroPreset').value.split('-').map(Number);
      const pPct = split[0]/100, cPct = split[1]/100, fPct = split[2]/100;
      const proteinG = Math.round((tdee * pPct) / 4);
      const carbsG = Math.round((tdee * cPct) / 4);
      const fatG = Math.round((tdee * fPct) / 9);

      // persist to localStorage key 'sd_goals' so the full dashboard/tracker can pick it up
      const goals = { calories: tdee, protein: proteinG, carbs: carbsG, fat: fatG };
      localStorage.setItem('sd_goals', JSON.stringify(goals));
      // update preview UI immediately
      setText('calGoalText', `Goal: ${goals.calories} kcal`);
      setText('proGoalText', `Goal: ${goals.protein} g`);
      setText('carbGoalText', `Goal: ${goals.carbs} g`);
      setText('fatGoalText', `Goal: ${goals.fat} g`);
      // progress bars: set to 0% (goals applied)
      $('calGoalBar').style.width = '0%';
      $('proGoalBar').style.width = '0%';
      $('carbGoalBar').style.width = '0%';
      $('fatGoalBar').style.width = '0%';
      toast('TDEE & macros applied to tracker goals');
    }

    // Apply only macro split to currently stored calories (if no stored calories, use TDEE or default)
    function applyMacrosToTracker(){
      // find calories to work with: saved sd_goals or lastCalc.tdee or default
      let currentGoals = JSON.parse(localStorage.getItem('sd_goals') || 'null');
      const calBase = currentGoals ? currentGoals.calories : (state.lastCalc ? state.lastCalc.tdee : defaults.calories);
      const split = $('macroPreset').value.split('-').map(Number);
      const pPct = split[0]/100, cPct = split[1]/100, fPct = split[2]/100;
      const proteinG = Math.round((calBase * pPct) / 4);
      const carbsG = Math.round((calBase * cPct) / 4);
      const fatG = Math.round((calBase * fPct) / 9);
      const goals = { calories: calBase, protein: proteinG, carbs: carbsG, fat: fatG };
      localStorage.setItem('sd_goals', JSON.stringify(goals));
      setText('calGoalText', `Goal: ${goals.calories} kcal`);
      setText('proGoalText', `Goal: ${goals.protein} g`);
      setText('carbGoalText', `Goal: ${goals.carbs} g`);
      setText('fatGoalText', `Goal: ${goals.fat} g`);
      $('calGoalBar').style.width = '0%';
      $('proGoalBar').style.width = '0%';
      $('carbGoalBar').style.width = '0%';
      $('fatGoalBar').style.width = '0%';
      toast('Macro split applied to tracker goals');
    }

    // Update the small preview from the given calculation (without persisting)
    function updateTrackerPreview(calc){
      const base = (calc && calc.tdee) || defaults.calories;
      const split = $('macroPreset').value.split('-').map(Number);
      const pPct = split[0]/100, cPct = split[1]/100, fPct = split[2]/100;
      const proteinG = Math.round((base * pPct) / 4);
      const carbsG = Math.round((base * cPct) / 4);
      const fatG = Math.round((base * fPct) / 9);
      setText('calGoalText', `Goal: ${base} kcal`);
      setText('proGoalText', `Goal: ${proteinG} g`);
      setText('carbGoalText', `Goal: ${carbsG} g`);
      setText('fatGoalText', `Goal: ${fatG} g`);
    }

    /*************** Misc actions ***************/
    function copyTdee(){
      if (!state.lastCalc || !state.lastCalc.tdee) { toast('Run calculators first'); return; }
      navigator.clipboard?.writeText(String(state.lastCalc.tdee)).then(()=> toast('TDEE copied')).catch(()=> toast('Copy failed'));
    }
    function copyAllResults(){
      const out = {
        lastCalc: state.lastCalc,
        navyBF: $('bfNavy').textContent || null
      };
      navigator.clipboard?.writeText(JSON.stringify(out, null, 2)).then(()=> toast('Results copied')).catch(()=> toast('Copy failed'));
    }

    function resetGoals(){
      localStorage.removeItem('sd_goals');
      setText('calGoalText', `Goal: ${defaults.calories} kcal`);
      setText('proGoalText', `Goal: ${defaults.protein} g`);
      setText('carbGoalText', `Goal: ${defaults.carbs} g`);
      setText('fatGoalText', `Goal: ${defaults.fat} g`);
      $('calGoalBar').style.width = '0%';
      $('proGoalBar').style.width = '0%';
      $('carbGoalBar').style.width = '0%';
      $('fatGoalBar').style.width = '0%';
      toast('Tracker goals reset');
    }

    /*************** Bind UI ***************/
    document.addEventListener('DOMContentLoaded', ()=> {
      // wire buttons
      $('calcRun').addEventListener('click', calculateAll);
      $('calcBfBtn').addEventListener('click', calcNavyBF);
      $('applyTdeeBtn').addEventListener('click', applyTdeeToTracker);
      $('applyMacroBtn').addEventListener('click', applyMacrosToTracker);
      $('copyTdeeBtn').addEventListener('click', copyTdee);
      $('copyResults').addEventListener('click', copyAllResults);
      $('printBtn').addEventListener('click', ()=> window.print());
      $('openFullTracker').addEventListener('click', ()=> { toast('Open full tracker in your dashboard — this is a preview'); });
      $('resetGoals').addEventListener('click', resetGoals);

      // load saved goals if any
      const savedGoals = JSON.parse(localStorage.getItem('sd_goals') || 'null');
      if (savedGoals) {
        setText('calGoalText', `Goal: ${savedGoals.calories} kcal`);
        setText('proGoalText', `Goal: ${savedGoals.protein} g`);
        setText('carbGoalText', `Goal: ${savedGoals.carbs} g`);
        setText('fatGoalText', `Goal: ${savedGoals.fat} g`);
      } else {
        // show defaults
        setText('calGoalText', `Goal: ${defaults.calories} kcal`);
        setText('proGoalText', `Goal: ${defaults.protein} g`);
        setText('carbGoalText', `Goal: ${defaults.carbs} g`);
        setText('fatGoalText', `Goal: ${defaults.fat} g`);
      }

      // shortcuts
      document.addEventListener('keydown', e => { if (e.key==='/' && document.activeElement.tagName !== 'INPUT') { e.preventDefault(); $('age').focus(); }});
    });
  </script>
</body>
</html>